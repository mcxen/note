# MySQL

## åŸºç¡€

### 1. MyISAMå’ŒInnoDBçš„å¯¹æ¯”

| ç‰¹æ€§           | InnoDB                                                       | MyISAM                                                       |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| äº‹åŠ¡æ”¯æŒ       | æ”¯æŒï¼ˆä½¿ç”¨å†™å‰æ—¥å¿—æŠ€æœ¯ï¼‰                                     | ä¸æ”¯æŒ                                                       |
| é”æœºåˆ¶         | æ”¯æŒè¡Œçº§é”å’Œè¡¨çº§é”ï¼ˆé»˜è®¤ä½¿ç”¨è¡Œçº§é”ï¼‰                         | åªæ”¯æŒè¡¨çº§é”                                                 |
| å¤–é”®çº¦æŸæ”¯æŒ   | æ”¯æŒ                                                         | ä¸æ”¯æŒ                                                       |
| æ•°æ®å­˜å‚¨å’Œç´¢å¼• | ä½¿ç”¨èšç°‡ç´¢å¼•ï¼Œæ•°æ®å’Œä¸»é”®ç´¢å¼•å­˜å‚¨åœ¨ä¸€èµ·ï¼Œæ”¯æŒå…¨æ–‡ç´¢å¼•å’Œå“ˆå¸Œç´¢å¼• | æ•°æ®å’Œç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œæ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œä¸æ”¯æŒå“ˆå¸Œç´¢å¼•             |
| æ•°æ®æ¢å¤å’Œå¤‡ä»½ | æ”¯æŒæ›´å¼ºçš„æ•°æ®æ¢å¤åŠŸèƒ½ï¼Œæ”¯æŒåœ¨çº¿å¤‡ä»½                         | æ•°æ®æ¢å¤èƒ½åŠ›è¾ƒå¼±ï¼Œä¾èµ–äºç‰©ç†å¤‡ä»½å’Œæ¢å¤                       |
| æ€§èƒ½           | åœ¨å¤§é‡è¯»å†™æ“ä½œå’Œé«˜å¹¶å‘ç¯å¢ƒä¸‹è¡¨ç°æ›´å¥½                         | åœ¨å¤„ç†åªè¯»æŸ¥è¯¢æ—¶å¯èƒ½æ›´å¿«ï¼Œä½†åœ¨å†™æ“ä½œé¢‘ç¹çš„åœºæ™¯ä¸‹æ€§èƒ½å¯èƒ½ä¸‹é™ |
| å­˜å‚¨ç©ºé—´       | è¾ƒå¤§ï¼Œéœ€è¦é¢å¤–ç©ºé—´å­˜å‚¨äº‹åŠ¡æ—¥å¿—ç­‰ï¼Œæ•°æ®æ–‡ä»¶å¤§å°åŠ¨æ€å¢é•¿       | ç›¸å¯¹è¾ƒå°ï¼Œæ•°æ®æ–‡ä»¶å¤§å°å›ºå®šï¼Œä¸æ”¯æŒæ•°æ®å‹ç¼©åŠŸèƒ½               |

> MyISAMå’ŒInnoDBæ˜¯MySQLä¸­ä¸¤ç§å¸¸è§çš„å­˜å‚¨å¼•æ“ï¼Œå®ƒä»¬åœ¨å¤šä¸ªæ–¹é¢å­˜åœ¨æ˜¾è‘—çš„åŒºåˆ«ã€‚ä»¥ä¸‹æ˜¯å¯¹ä¸¤è€…çš„æ¯”è¾ƒï¼š
>
> 1. äº‹åŠ¡æ”¯æŒï¼š InnoDBæ”¯æŒäº‹åŠ¡ï¼Œå…·æœ‰æäº¤ã€å›æ»šå’Œå´©æºƒæ¢å¤èƒ½åŠ›ï¼Œå¯ä»¥ä¿æŠ¤ç”¨æˆ·æ•°æ®ã€‚å®ƒä½¿ç”¨äº†ä¸€ç§ç§°ä¸ºâ€œå†™å‰æ—¥å¿—â€ï¼ˆwrite-ahead loggingï¼ŒWALï¼‰çš„æŠ€æœ¯ï¼Œ**å…ˆå†™æ—¥å¿—ï¼Œå†å†™æ•°æ®ï¼Œä¿è¯äº†äº‹åŠ¡çš„å®Œæ•´æ€§ã€‚** MyISAMä¸æ”¯æŒäº‹åŠ¡ï¼Œè¿™æ„å‘³ç€åœ¨MyISAMä¸­è¿›è¡Œçš„æ›´æ”¹æ— æ³•å›æ»šï¼Œä¸”å¦‚æœå‘ç”Ÿå´©æºƒï¼Œæ•°æ®å¯èƒ½ä¼šæŸåã€‚
> 2. é”æœºåˆ¶ï¼š **InnoDBæ”¯æŒè¡Œçº§é”å’Œè¡¨çº§é”ï¼Œä½†é»˜è®¤ä½¿ç”¨è¡Œçº§é”ã€‚**è¡Œçº§é”å¯ä»¥æé«˜å¹¶å‘æ€§èƒ½ï¼Œå› ä¸ºå®ƒåªé”å®šè¢«è®¿é—®çš„è¡Œï¼Œè€Œä¸æ˜¯æ•´ä¸ªè¡¨ã€‚ **MyISAMåªæ”¯æŒè¡¨çº§é”**ï¼Œè¿™æ„å‘³ç€å½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨å¯¹ä¸€ä¸ªè¡¨è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•å¯¹è¯¥è¡¨è¿›è¡Œè¯»æˆ–å†™æ“ä½œã€‚è¿™å¯èƒ½ä¼šé™ä½å¹¶å‘æ€§èƒ½ã€‚
> 3. å¤–é”®æ”¯æŒï¼š **InnoDBæ”¯æŒå¤–é”®çº¦æŸ**ï¼Œè¿™æœ‰åŠ©äºç»´æŠ¤æ•°æ®çš„å¼•ç”¨å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚ MyISAMä¸æ”¯æŒå¤–é”®çº¦æŸã€‚
> 4. æ•°æ®å­˜å‚¨å’Œç´¢å¼•ï¼š InnoDBä½¿ç”¨èšç°‡ç´¢å¼•æ¥ç»„ç»‡æ•°æ®ï¼Œè¡¨æ•°æ®å’Œä¸»é”®ç´¢å¼•å­˜å‚¨åœ¨ä¸€èµ·ã€‚æ­¤å¤–ï¼ŒInnoDBè¿˜æ”¯æŒå…¨æ–‡ç´¢å¼•å’Œå“ˆå¸Œç´¢å¼•ã€‚ MyISAMå°†æ•°æ®å’Œç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œæ•°æ®æ–‡ä»¶ï¼ˆMYDï¼‰å’Œç´¢å¼•æ–‡ä»¶ï¼ˆMYIï¼‰æ˜¯åˆ†ç¦»çš„ã€‚MyISAMä¹Ÿæ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œä½†ä¸æ”¯æŒå“ˆå¸Œç´¢å¼•ã€‚
> 5. æ•°æ®æ¢å¤å’Œå¤‡ä»½ï¼š InnoDBæä¾›äº†æ›´å¥½çš„æ•°æ®æ¢å¤åŠŸèƒ½ï¼Œå¦‚é€šè¿‡binlogè¿›è¡Œç‚¹æ—¶é—´æ¢å¤ï¼ˆPITRï¼‰ã€‚æ­¤å¤–ï¼ŒInnoDBè¿˜æ”¯æŒåœ¨çº¿å¤‡ä»½åŠŸèƒ½ã€‚ MyISAMçš„æ•°æ®æ¢å¤ç›¸å¯¹è¾ƒå¼±ï¼Œé€šå¸¸ä¾èµ–äºç‰©ç†å¤‡ä»½å’Œæ¢å¤ã€‚
> 6. æ€§èƒ½ï¼š InnoDBåœ¨å¤„ç†å¤§é‡è¯»å†™æ“ä½œæ—¶é€šå¸¸è¡¨ç°æ›´å¥½ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ã€‚è¿™å¾—ç›Šäºå…¶è¡Œçº§é”å’Œäº‹åŠ¡æ”¯æŒã€‚ MyISAMåœ¨å¤„ç†åªè¯»æŸ¥è¯¢æ—¶å¯èƒ½æ›´å¿«ï¼Œç‰¹åˆ«æ˜¯å½“æ•°æ®é‡å¾ˆå¤§ä¸”å†…å­˜å……è¶³æ—¶ã€‚ç„¶è€Œï¼Œåœ¨å†™æ“ä½œé¢‘ç¹çš„åœºæ™¯ä¸‹ï¼ŒMyISAMçš„æ€§èƒ½å¯èƒ½ä¼šä¸‹é™ã€‚
> 7. å­˜å‚¨ç©ºé—´ï¼š InnoDBçš„å­˜å‚¨ç©ºé—´é€šå¸¸æ¯”MyISAMå¤§ï¼Œå› ä¸ºå®ƒéœ€è¦é¢å¤–çš„ç©ºé—´æ¥å­˜å‚¨äº‹åŠ¡æ—¥å¿—ã€è¡Œçº§é”ç­‰ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒInnoDBçš„æ•°æ®æ–‡ä»¶å¤§å°æ˜¯åŠ¨æ€å¢é•¿çš„ã€‚ MyISAMçš„å­˜å‚¨ç©ºé—´ç›¸å¯¹è¾ƒå°ï¼Œæ•°æ®æ–‡ä»¶å¤§å°æ˜¯å›ºå®šçš„ï¼ˆå¯ä»¥é€šè¿‡é…ç½®ä¿®æ”¹ï¼‰ã€‚ä½†æ˜¯ï¼ŒMyISAMä¸æ”¯æŒæ•°æ®å‹ç¼©åŠŸèƒ½ã€‚



### 2. MySQLå¦‚ä½•å»é™¤é‡å¤

DISTINCTå’ŒGROUP BYéƒ½ç”¨äºå¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œå»é‡ï¼Œä½†å®ƒä»¬çš„ç”¨æ³•å’Œæ€§èƒ½ç•¥æœ‰ä¸åŒã€‚

- DISTINCTç”¨äºè¿”å›å”¯ä¸€çš„å€¼ï¼Œå®ƒä¼šåœ¨æ•´ä¸ªç»“æœé›†ä¸­å»é™¤é‡å¤è¡Œã€‚
- GROUP BYç”¨äºå°†ç»“æœæŒ‰ç…§æŒ‡å®šçš„åˆ—è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨èšåˆå‡½æ•°å¯¹æ¯ä¸ªç»„è¿›è¡Œè®¡ç®—ï¼ˆå¦‚COUNTã€SUMç­‰ï¼‰ã€‚

åœ¨æ€§èƒ½æ–¹é¢ï¼Œé€šå¸¸æ¥è¯´ä½¿ç”¨DISTINCTæ¯”ä½¿ç”¨GROUP BYæ€§èƒ½æ›´å¥½ï¼Œå› ä¸ºDISTINCTåªéœ€è¦æ‰¾å‡ºå¹¶è¿”å›å”¯ä¸€çš„å€¼ï¼Œè€ŒGROUP BYéœ€è¦è¿›è¡Œåˆ†ç»„æ“ä½œå’Œèšåˆè®¡ç®—ï¼Œæ¶ˆè€—çš„èµ„æºæ›´å¤šã€‚æ‰€ä»¥å¦‚æœåªæ˜¯ç®€å•åœ°å»é‡ï¼Œæ¨èä½¿ç”¨DISTINCTï¼›å¦‚æœéœ€è¦è¿›è¡Œåˆ†ç»„è®¡ç®—æˆ–è€…èšåˆæ“ä½œï¼Œå°±éœ€è¦ä½¿ç”¨GROUP BYã€‚

## ç´¢å¼•

### 1.å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢é€Ÿåº¦ï¼Ÿ

>  åˆ›å»ºé€‚å½“çš„ç´¢å¼•ï¼Œä¼˜åŒ–æŸ¥è¯¢è¯­å¥ï¼Œé¿å…å…¨å±€æ‰«æï¼Œç¼“å­˜æŸ¥è¯¢ç»“æœï¼Œæå‡ç¡¬ä»¶ï¼Œæ•°æ®å½’æ¡£å’Œåˆ†ç¦»ï¼Œæ•°æ®åº“åˆ†ç‰‡ã€‚

**åˆ›å»ºé€‚å½“çš„ç´¢å¼•**

é€šè¿‡åˆ›å»ºé€‚å½“çš„ç´¢å¼•ï¼Œå¯ä»¥åŠ é€ŸæŸ¥è¯¢æ“ä½œã€‚ç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæ•ˆç‡ï¼Œå°¤å…¶æ˜¯å¯¹äºå¸¸ç”¨çš„æŸ¥è¯¢æ¡ä»¶å’Œæ’åºå­—æ®µè¿›è¡Œç´¢å¼•ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘æŸ¥è¯¢çš„æ‰«æèŒƒå›´å’Œ IO å¼€é”€ã€‚

**ä¼˜åŒ–æŸ¥è¯¢è¯­å¥**

ä¼˜åŒ–æŸ¥è¯¢è¯­å¥æœ¬èº«ï¼Œé¿å…å…¨è¡¨æ‰«æå’Œå¤§æ•°æ®é‡çš„å…³è”æŸ¥è¯¢ã€‚å¯ä»¥ä¼˜åŒ–æŸ¥è¯¢æ¡ä»¶ï¼Œä½¿ç”¨åˆé€‚çš„ç´¢å¼•ã€åˆç†çš„æŸ¥è¯¢ç­–ç•¥ï¼Œå‡å°‘ä¸å¿…è¦çš„å­—æ®µå’Œæ•°æ®è¿”å›ã€‚

**ç¼“å­˜æŸ¥è¯¢ç»“æœ**

å¯¹äºä¸€äº›ç›¸å¯¹ç¨³å®šçš„æŸ¥è¯¢ç»“æœï¼Œå¯ä»¥å°†å…¶ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œé¿å…é‡å¤æŸ¥è¯¢æ•°æ®åº“ï¼Œæé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚

ç¼“å­˜çš„æŸ¥è¯¢é€Ÿåº¦ä¸€å®šæ¯”ç›´æ¥æŸ¥è¯¢æ•°æ®åº“çš„æ•ˆç‡é«˜ï¼Œè¿™æ˜¯å› ä¸ºç¼“å­˜å…·å¤‡ä»¥ä¸‹ç‰¹å¾ï¼š

1. å†…å­˜è®¿é—®é€Ÿåº¦å¿«ï¼šç¼“å­˜é€šå¸¸å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè€Œæ•°æ®åº“å°†æ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚ç›¸æ¯”äºç£ç›˜è®¿é—®ï¼Œå†…å­˜è®¿é—®é€Ÿåº¦æ›´å¿«ï¼Œå¯ä»¥è¾¾åˆ°çº³ç§’çº§åˆ«çš„è¯»å–é€Ÿåº¦ï¼Œè¿œè¿œå¿«äºæ•°æ®åº“çš„æ¯«ç§’çº§åˆ«çš„è¯»å–é€Ÿåº¦ã€‚
2. IO æ“ä½œæ¬¡æ•°å°‘ï¼šæ•°æ®åº“é€šå¸¸éœ€è¦è¿›è¡Œç£ç›˜ IO æ“ä½œï¼ŒåŒ…æ‹¬è¯»å–å’Œå†™å…¥ç£ç›˜æ•°æ®ã€‚è€Œç¼“å­˜å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé¿å…äº†ç£ç›˜ IO çš„å¼€é”€ã€‚å†…å­˜è®¿é—®ä¸éœ€è¦è¿›è¡Œç£ç›˜å¯»å€å’Œæœºæ¢°è¿åŠ¨ï¼Œç›¸å¯¹æ¥è¯´é€Ÿåº¦æ›´å¿«ã€‚
3. ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼šç¼“å­˜çš„æ•°æ®ç»“æ„é€šå¸¸ä¸º key-value å½¢å¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç¼“å­˜å¯ä»¥åšåˆ°ä»»ä½•æ•°æ®é‡çº§ä¸‹çš„æŸ¥è¯¢æ•°æ®å¤æ‚åº¦ä¸º O(1)ï¼Œæ‰€ä»¥å®ƒçš„æŸ¥è¯¢æ•ˆç‡æ˜¯éå¸¸é«˜çš„ï¼›è€Œæ•°æ®åº“é‡‡ç”¨çš„æ˜¯ä¼ ç»Ÿæ•°æ®ç»“æ„è®¾è®¡ï¼Œå¯èƒ½éœ€è¦æŸ¥è¯¢äºŒå‰æ ‘ã€æˆ–å…¨æ–‡æœç´¢ã€æˆ–å›è¡¨æŸ¥è¯¢ç­‰æ“ä½œï¼Œæ‰€ä»¥å…¶æŸ¥è¯¢æ€§èƒ½æ˜¯è¿œä½äºç¼“å­˜ç³»ç»Ÿçš„ã€‚

**æå‡ç¡¬ä»¶é…ç½®**

å¯¹äºå¤§æ•°æ®é‡çš„è¡¨ï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨æ›´é«˜æ€§èƒ½çš„ç¡¬ä»¶è®¾å¤‡ï¼Œå¦‚æ›´å¿«çš„å­˜å‚¨ä»‹è´¨ï¼ˆå¦‚å›ºæ€ç¡¬ç›˜ï¼‰ï¼Œæ›´å¤§çš„å†…å­˜å®¹é‡ç­‰ï¼Œä»¥æå‡æŸ¥è¯¢çš„ IO æ€§èƒ½ã€‚

**æ•°æ®å½’æ¡£å’Œåˆ†ç¦»**

å¯¹äºå†å²æ•°æ®æˆ–ä¸ç»å¸¸è®¿é—®çš„æ•°æ®ï¼Œå¯ä»¥è¿›è¡Œå½’æ¡£å’Œåˆ†ç¦»ï¼Œå°†è¿™äº›æ•°æ®ä»ä¸»è¡¨ä¸­ç‹¬ç«‹å‡ºæ¥ï¼Œå‡å°‘ä¸»è¡¨çš„æ•°æ®é‡ï¼Œæé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚

**æ•°æ®åº“åˆ†ç‰‡**

å½“å•ä¸ªæ•°æ®åº“æ— æ³•æ»¡è¶³æŸ¥è¯¢æ€§èƒ½éœ€æ±‚æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ•°æ®åº“åˆ†ç‰‡æŠ€æœ¯ï¼Œå°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªæ•°æ®åº“ä¸­ï¼Œæ¯ä¸ªæ•°æ®åº“åªå¤„ç†éƒ¨åˆ†æ•°æ®ï¼Œä»è€Œæé«˜æŸ¥è¯¢çš„å¹¶å‘åº¦å’Œæ•´ä½“æ€§èƒ½ã€‚

æ•°æ®åº“åˆ†ç‰‡æŠ€æœ¯çš„å…·ä½“å®ç°æ˜¯åˆ†åº“åˆ†è¡¨ã€‚

### 2. æ•°æ®åº“å››å¤§ç‰¹æ€§å’Œå››å¤§éš”ç¦»çº§åˆ«

MySQL äº‹åŠ¡å…·å¤‡ ACID å››å¤§ç‰¹æ€§ï¼Œå¦‚ä¸‹æ‰€è¿°ï¼š

1. **åŸå­æ€§ï¼ˆAtomicityï¼‰**ï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šï¼Œä¸èƒ½åªæ‰§è¡Œå…¶ä¸­ä¸€éƒ¨åˆ†æ“ä½œã€‚
2. **ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰**ï¼šäº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´åï¼Œæ•°æ®æ€»æ˜¯ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚
3. **éš”ç¦»æ€§ï¼ˆIsolationï¼‰**ï¼šäº‹åŠ¡ä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œæ¯ä¸ªäº‹åŠ¡å¯¹å…¶ä»–äº‹åŠ¡çš„æ“ä½œæ˜¯é€æ˜çš„ï¼Œä¸€ä¸ªäº‹åŠ¡çš„ä¸­é—´ç»“æœå¯¹å…¶ä»–äº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚
4. **æŒä¹…æ€§ï¼ˆDurabilityï¼‰**ï¼šäº‹åŠ¡å®Œæˆåï¼Œå¯¹æ•°æ®åº“çš„ä¿®æ”¹å°†æ°¸ä¹…ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œå³ä½¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚

å…¶ä¸­ï¼Œéš”ç¦»æ€§æ˜¯å®ç°äº‹åŠ¡çš„é‡è¦ç‰¹å¾ä¹‹ä¸€ã€‚

MySQL ä¸­æä¾›äº†å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š

1. è¯»æœªæäº¤ï¼ˆRead Uncommittedï¼‰
2. è¯»å·²æäº¤ï¼ˆRead Committedï¼‰
3. å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰
4. ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰

ä¸åŒçš„äº‹åŠ¡éš”ç¦»è§£å†³å¯ä»¥è§£å†³ä¸åŒçš„é—®é¢˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![img](https://cdn.jsdelivr.net/gh/52chen/imagebed2023@main/picgo/1687165869094-c5f1d452-4af9-4d1f-ab4a-27ecbfd24a2b.png)

### 3. äº‹åŠ¡çš„å®ç°åŸç†

åŸå­æ€§ï¼šAtom äº‹åŠ¡è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¸å…¨éƒ¨å¤±è´¥ï¼Œé€šè¿‡é‡åšæ—¥å¿—æ¥å®ç°

ä¸€è‡´æ€§ï¼šConsistency æ•°æ®å®Œæ•´æ€§åœ¨äº‹ç‰©æ‰§è¡Œå‰åéƒ½æ²¡æœ‰å˜åŒ–ï¼Œä¸€è‡´æ€§çŠ¶æ€ï¼Œé€šè¿‡å›æ»šæ—¥å¿—å®ç°

éš”ç¦»æ€§ï¼šIsolation äº‹åŠ¡å¯¹å…¶ä»–äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œé€šè¿‡é”å®ç°

æŒä¹…æ€§ï¼šDurability æ•°æ®åº“ä¿®æ”¹æ˜¯æ°¸ä¹…ä¿å­˜çš„ï¼Œé‡åšæ—¥å¿—å®ç°

---

redo logï¼ˆé‡åšæ—¥å¿—ï¼‰ å®ç° åŸå­æ€§ã€æŒä¹…æ€§

äº‹åŠ¡æäº¤ä¹‹åï¼Œå…ˆå°†äº‹åŠ¡å†™å…¥redo logæ—¥å¿—ï¼Œåç»­å†å°† Buffer Pool ä¸­ä¿®æ”¹æ•°æ®æ…¢æ…¢å†™å…¥åˆ°ç£ç›˜ã€‚

æ­¤æ—¶å¦‚æœæ•°æ®åº“å´©æºƒæˆ–è€…å®•æœºï¼ŒBuffer Pool ä¸­çš„æ•°æ®ä¸¢å¤±ï¼Œå¯èƒ½æœ‰éƒ¨åˆ†å·²ä¿®æ”¹æ•°æ®æœªèƒ½åŒæ­¥åˆ°ç£ç›˜ã€‚

é‚£ä¹ˆï¼Œå½“ç³»ç»Ÿé‡å¯è¿›è¡Œæ¢å¤æ—¶ï¼Œå°±å¯ä»¥æ ¹æ®redo logä¸­è®°å½•çš„æ—¥å¿—ï¼ŒæŠŠæ•°æ®åº“æ¢å¤åˆ°å´©æºƒå‰çš„ä¸€ä¸ªçŠ¶æ€ã€‚


undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰å®ç° ä¸€è‡´æ€§

undo logè®°å½•äº†æ•°æ®åœ¨æ“ä½œå‰çš„çŠ¶æ€ï¼Œå¦‚æœäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦å›æ»šï¼Œå°±å¯ä»¥æ ¹æ®undo logè¿›è¡Œå›æ»šæ“ä½œã€‚å•ä¸ªäº‹åŠ¡çš„å›æ»šï¼Œåªä¼šå›æ»šå½“å‰äº‹åŠ¡åšçš„æ“ä½œï¼Œå¹¶ä¸ä¼šå½±å“åˆ°å…¶ä»–çš„äº‹åŠ¡åšçš„æ“ä½œã€‚


ä»¥ä¸€ä¸ªupdateè¯­å¥æ‰§è¡Œä¸ºä¾‹ï¼š

```xml
Innodbå¼•æ“åœ¨æ”¶åˆ°ä¸€ä¸ªupdateè¯­å¥åï¼Œä¼šå…ˆæ ¹æ®æ¡ä»¶æ‰¾åˆ°æ•°æ®æ‰€åœ¨çš„é¡µï¼Œå¹¶å°†è¯¥é¡µç¼“å­˜åœ¨ BufferPool ä¸­ï¼ˆä¹Ÿå°±æ˜¯å†…å­˜ä¸­ï¼‰ã€‚
æ‰§è¡Œupdateè¯­å¥ï¼Œä¿®æ”¹ BufferPool ä¸­çš„æ•°æ®ã€‚
é’ˆå¯¹updateè¯­å¥ç”Ÿæˆä¸€ä¸ª RedoLog å¯¹è±¡ï¼Œå¹¶å­˜å…¥ LoggerBuffer ä¸­ã€‚
é’ˆå¯¹updateè¯­å¥ç”Ÿæˆ UndoLog æ—¥å¿—ï¼Œç”¨äºäº‹åŠ¡å›æ»šã€‚
å¦‚æœæäº¤äº‹åŠ¡ï¼Œé‚£ä¹ˆä¹…å°† RedoLog å¯¹è±¡è¿›è¡ŒæŒä¹…åŒ–ï¼Œåç»­è¿˜æœ‰å…¶ä»–æœºåˆ¶å°† BufferPool ä¸­ä¿®æ”¹çš„æ•°æ®é¡µæŒä¹…åŒ–åˆ°ç£ç›˜ã€‚
å¦‚æœäº‹åŠ¡å›æ»šï¼Œé‚£ä¹ˆåˆ™åˆ©ç”¨ UndoLog æ—¥å¿—è¿›è¡Œæ•°æ®æ¢å¤ã€‚
```

### 4. ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ŒB+æ ‘ğŸŒ²ä¸ºä»€ä¹ˆæŸ¥è¯¢å¿«ï¼Ÿ

> - 

MySQL é»˜è®¤çš„å­˜å‚¨å¼•æ“ InnoDB é‡‡ç”¨çš„æ˜¯ B+ ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ŒåŸå› æœ‰ï¼š

1.**B+ æ ‘çš„éå¶å­èŠ‚ç‚¹ä¸å­˜æ”¾å®é™…çš„è®°å½•æ•°æ®ï¼Œä»…å­˜æ”¾ç´¢å¼•**ï¼Œå› æ­¤æ•°æ®é‡ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œç›¸æ¯”å­˜å‚¨å³å­˜ç´¢å¼•åˆå­˜è®°å½•çš„ B æ ‘ï¼ŒB+æ ‘çš„éå¶å­èŠ‚ç‚¹å¯ä»¥å­˜æ”¾æ›´å¤šçš„ç´¢å¼•ï¼Œå› æ­¤ B+ æ ‘å¯ä»¥æ¯” B æ ‘æ›´ã€ŒçŸ®èƒ–ã€ï¼Œ**æŸ¥è¯¢åº•å±‚èŠ‚ç‚¹çš„ç£ç›˜ I/Oæ¬¡æ•°ä¼šæ›´å°‘ã€‚**ï¼ˆä¸ºä»€ä¹ˆä¸é€‰äºŒå‰æ ‘ä¹Ÿæœ‰ç±»ä¼¼åŸå› )

2.**B+ æ ‘æœ‰å¤§é‡çš„å†—ä½™èŠ‚ç‚¹ï¼ˆæ‰€æœ‰éå¶å­èŠ‚ç‚¹éƒ½æ˜¯å†—ä½™ç´¢å¼•ï¼‰**ï¼Œè¿™äº›å†—ä½™ç´¢å¼•è®© B+ æ ‘åœ¨æ’å…¥ã€åˆ é™¤çš„æ•ˆç‡éƒ½æ›´é«˜ï¼Œæ¯”å¦‚åˆ é™¤æ ¹èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¸ä¼šåƒ B æ ‘é‚£æ ·ä¼šå‘ç”Ÿ**å¤æ‚çš„æ ‘çš„å˜åŒ–**ï¼›

3.**B+ æ ‘å¶å­èŠ‚ç‚¹ä¹‹é—´ç”¨é“¾è¡¨è¿æ¥äº†èµ·æ¥ï¼Œæœ‰åˆ©äºèŒƒå›´æŸ¥è¯¢**ï¼Œè€Œ **B æ ‘è¦å®ç°èŒƒå›´æŸ¥è¯¢ï¼Œå› æ­¤åªèƒ½é€šè¿‡æ ‘çš„éå†**æ¥å®ŒæˆèŒƒå›´æŸ¥è¯¢ï¼Œè¿™ä¼šæ¶‰åŠå¤šä¸ªèŠ‚ç‚¹çš„ç£ç›˜ I/O æ“ä½œï¼ŒèŒƒå›´æŸ¥è¯¢æ•ˆç‡ä¸å¦‚ B+ æ ‘ã€‚

> ![å›¾ç‰‡](MySQL-é¢è¯•æ•´ç†.assets/dd076212a7637b9032c97a615c39dcd7.png)

### 5. InnoDBå’ŒMyISAMçš„B+æ ‘çš„åŒºåˆ«

è™½ç„¶ï¼ŒInnoDB å’Œ MyISAM éƒ½æ”¯æŒ B+ æ ‘ç´¢å¼•ï¼Œä½†æ˜¯å®ƒä»¬æ•°æ®çš„å­˜å‚¨ç»“æ„å®ç°æ–¹å¼ä¸åŒã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼š

- InnoDB å­˜å‚¨å¼•æ“ï¼šB+ æ ‘ç´¢å¼•çš„**å¶å­èŠ‚ç‚¹ä¿å­˜æ•°æ®æœ¬èº«**ï¼›

  ![å›¾ç‰‡](https://fastly.jsdelivr.net/gh/52chen/imagebed2023@main/uPic/ef726d7287b854ea4862f7442d8012ec.png)

- MyISAM å­˜å‚¨å¼•æ“ï¼šB+ æ ‘ç´¢å¼•çš„**å¶å­èŠ‚ç‚¹ä¿å­˜æ•°æ®çš„ç‰©ç†åœ°å€**ï¼›

  ![å›¾ç‰‡](https://fastly.jsdelivr.net/gh/52chen/imagebed2023@main/uPic/f287701eba9bf6f32a2d09b013bb451b-20240324091300356.png)

### 5. èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•å¯¹æ¯”

**èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„æ¯”è¾ƒ**

**æŸ¥è¯¢æ€§èƒ½**ï¼šèšç°‡ç´¢å¼•é€šå¸¸å¯¹èŒƒå›´æŸ¥è¯¢æ›´ä¸ºé«˜æ•ˆï¼Œå› ä¸ºå®ƒå°†æ•°æ®æŒ‰ç…§ç´¢å¼•é”®å€¼çš„é¡ºåºå­˜å‚¨ã€‚ç„¶è€Œï¼Œéèšç°‡ç´¢å¼•å¯èƒ½åœ¨æŸäº›æƒ…å†µä¸‹æä¾›æ›´å¥½çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å½“ç´¢å¼•è¦†ç›–æŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰åˆ—æ—¶ï¼ˆå³è¦†ç›–ç´¢å¼•ï¼‰ã€‚

**æ›´æ–°å¼€é”€**ï¼šå½“æ•°æ®è¡Œçš„é”®å€¼ï¼ˆå³èšç°‡ç´¢å¼•çš„é”®å€¼ï¼‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œèšç°‡ç´¢å¼•å¯èƒ½éœ€è¦é‡æ–°ç»„ç»‡æ•°æ®çš„å­˜å‚¨é¡ºåºï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ›´å¤§çš„æ›´æ–°å¼€é”€ã€‚è€Œéèšç°‡ç´¢å¼•åªéœ€è¦æ›´æ–°ç´¢å¼•æ¡ç›®ã€‚

### 6. æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™,ç´¢å¼•ä¸‹æ¨æ˜¯ä»€ä¹ˆï¼Ÿ

**æœ€å·¦åŒ¹é…åŸåˆ™**

**å½“MySQLä½¿ç”¨è”åˆç´¢å¼•è¿›è¡ŒæŸ¥è¯¢**æ—¶ï¼Œä¼šä»**ç´¢å¼•çš„æœ€å·¦è¾¹å¼€å§‹åŒ¹é…æŸ¥è¯¢æ¡ä»¶**ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­åŒ…å«äº†ç´¢å¼•å·¦è¾¹çš„åˆ—ï¼Œé‚£ä¹ˆMySQLæ‰å¯èƒ½ä¼šä½¿ç”¨è¿™ä¸ªç´¢å¼•æ¥ä¼˜åŒ–æŸ¥è¯¢ã€‚å¦‚æœæŸ¥è¯¢æ¡ä»¶æ²¡æœ‰åŒ…å«å·¦è¾¹çš„åˆ—æˆ–è€…å·¦è¾¹çš„åˆ—å‡ºç°ä¸€äº›èŒƒå›´æŸ¥è¯¢ï¼ˆ>ã€<ã€betweenç­‰ï¼‰ï¼Œå³ä½¿å…¶ä»–åˆ—éƒ½åœ¨ç´¢å¼•ä¸­ï¼ŒMySQLä¹Ÿå¯èƒ½ä¸ä¼šä½¿ç”¨è¿™ä¸ªç´¢å¼•ã€‚

> ```SQL
> -- åŸºäºä¸Šé¢çš„å“ªä¸ªï¼ˆXã€Yã€Zï¼‰è”åˆç´¢å¼•
> 
> //ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŸåˆ™ï¼Œæœ€å·¦ä¾§çš„Xå­—æ®µæœªæ›¾è¢«ä½¿ç”¨
> SELECT * FROM tb WHERE Y = "..." AND Z = "..."; 
> 
> // Xå‡ºç°èŒƒå›´æŸ¥è¯¢ï¼Œä¸èƒ½è¢«ä½¿ç”¨
> SELECT * FROM tb WHERE X > 10 AND Y = "..." AND Z = "..."; 
> ```

**ç´¢å¼•ä¸‹æ¨æ˜¯ä»€ä¹ˆï¼Ÿ**

ç›´è¯‘ï¼šä¹Ÿå°±æ˜¯å°†Serverå±‚ç­›é€‰æ•°æ®çš„å·¥ä½œï¼Œä¸‹æ¨åˆ°å¼•æ“å±‚å¤„ç†ã€‚

è§£é‡Šï¼šåœ¨**æ²¡æœ‰ç´¢å¼•ä¸‹æ¨çš„æƒ…å†µä¸‹**ï¼ŒMySQLä¼šå…ˆä»ç´¢å¼•ä¸­è·å–æ‰€æœ‰å¯èƒ½æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œçš„ä¸»é”®ï¼Œç„¶**åæ ¹æ®è¿™äº›ä¸»é”®æ£€ç´¢å®Œæ•´çš„æ•°æ®è¡Œ(å³å›è¡¨)ï¼Œ**æœ€åå†åº”ç”¨WHEREæ¡ä»¶è¿›è¡Œè¿‡æ»¤ã€‚è€Œ**æœ‰äº†ç´¢å¼•ä¸‹æ¨**ï¼ŒMySQLå¯ä»¥åœ¨æ‰«æç´¢å¼•çš„åŒæ—¶ï¼Œ**ç›´æ¥æ ¹æ®ç´¢å¼•ä¸­çš„å€¼æ¥åˆ¤æ–­æ˜¯å¦æ»¡è¶³WHEREæ¡ä»¶**ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„å›è¡¨æ“ä½œã€‚

### 7.ä»€ä¹ˆåœºæ™¯ä¸‹æˆ‘ä»¬ä½¿ç”¨Mysqlï¼Œä»€ä¹ˆæƒ…å†µä¸‹æˆ‘ä»¬ç”¨Redisï¼Ÿ

> **ä½¿ç”¨MySQLçš„åœºæ™¯**ï¼š
>
> 1. å…³ç³»å‹æ•°æ®å­˜å‚¨ï¼šMySQLæ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆRDBMSï¼‰ï¼Œéå¸¸é€‚åˆå­˜å‚¨å’ŒæŸ¥è¯¢ç»“æ„åŒ–æ•°æ®ï¼Œå³æ•°æ®ä¹‹é—´å­˜åœ¨æ˜ç¡®å…³ç³»çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œç”µå•†ç½‘ç«™ä¸­çš„ç”¨æˆ·ä¿¡æ¯ã€è®¢å•ä¿¡æ¯ã€å•†å“ä¿¡æ¯ç­‰ã€‚
> 2. äº‹åŠ¡å¤„ç†ï¼šMySQLæ”¯æŒACIDäº‹åŠ¡ç‰¹æ€§ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥ä¿è¯ä¸€ç³»åˆ—æ“ä½œçš„åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§ã€‚å¯¹äºéœ€è¦ç¡®ä¿æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§çš„åº”ç”¨ï¼Œå¦‚é“¶è¡Œè½¬è´¦ã€è®¢å•å¤„ç†ç­‰ï¼ŒMySQLæ˜¯ç†æƒ³çš„é€‰æ‹©ã€‚
> 3. å¤æ‚æŸ¥è¯¢ï¼šMySQLæ”¯æŒSQLï¼ˆç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼‰ï¼Œå¯ä»¥è¿›è¡Œå¤æ‚çš„æŸ¥è¯¢æ“ä½œï¼Œå¦‚è¿æ¥ã€èšåˆã€æ’åºç­‰ã€‚å¯¹äºéœ€è¦è¿›è¡Œå¤§é‡æ•°æ®å¤„ç†å’Œåˆ†æçš„åº”ç”¨ï¼ŒMySQLéå¸¸é€‚ç”¨ã€‚
>
> **ä½¿ç”¨Redisçš„åœºæ™¯**ï¼š
>
> 1. ç¼“å­˜ï¼šRedisæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å†…å­˜æ•°æ®åº“ï¼Œé€šå¸¸ç”¨ä½œç¼“å­˜å±‚ï¼Œä»¥å‡å°‘å¯¹åç«¯æ•°æ®åº“çš„è®¿é—®ã€‚å¯¹äºè¯»å¤šå†™å°‘ã€æ•°æ®å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„åº”ç”¨ï¼Œå¦‚æ–°é—»ç½‘ç«™ã€ç¤¾äº¤åª’ä½“ç­‰ï¼Œä½¿ç”¨Redisä½œä¸ºç¼“å­˜å¯ä»¥æ˜¾è‘—æé«˜æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚
> 2. å®æ—¶æ•°æ®å¤„ç†ï¼šRedisæ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼ˆå¦‚å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆå’Œæœ‰åºé›†åˆç­‰ï¼‰ï¼Œå¹¶ä¸”æä¾›äº†ä¸°å¯Œçš„æ“ä½œå‘½ä»¤ã€‚è¿™ä½¿å¾—Rediséå¸¸é€‚åˆå¤„ç†å®æ—¶æ•°æ®æµï¼Œå¦‚å®æ—¶æ’è¡Œæ¦œã€å®æ—¶ç»Ÿè®¡ç­‰ã€‚
> 3. æ¶ˆæ¯é˜Ÿåˆ—ï¼šRedisæä¾›äº†å‘å¸ƒ/è®¢é˜…åŠŸèƒ½å’Œé˜»å¡é˜Ÿåˆ—ç­‰ç‰¹æ€§ï¼Œå¯ä»¥ç”¨ä½œæ¶ˆæ¯ä¸­é—´ä»¶æ¥å®ç°å¼‚æ­¥é€šä¿¡å’Œåˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´çš„è§£è€¦ã€‚
> 4. é«˜å¹¶å‘åœºæ™¯ï¼šç”±äºRedisåŸºäºå†…å­˜å­˜å‚¨ä¸”é‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹ï¼ˆå®é™…ä¸Šæ˜¯é€šè¿‡IOå¤šè·¯å¤ç”¨æ¥å¤„ç†å¹¶å‘è¯·æ±‚ï¼‰ï¼Œå®ƒåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹è¡¨ç°ä¼˜å¼‚ã€‚å¯¹äºéœ€è¦å¿«é€Ÿå“åº”å¤§é‡å¹¶å‘è¯·æ±‚çš„åº”ç”¨ï¼Œå¦‚ç§’æ€ç³»ç»Ÿã€å®æ—¶æ¨èç³»ç»Ÿç­‰ï¼ŒRedisæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚

> **Rediså¿«ï¼Œé‚£Mysqlä¸æ˜¯ä¹Ÿæœ‰ç´¢å¼•å—ï¼Œä¸ºä»€ä¹ˆè¦ç”¨redis?**
>
> ç¡®å®ï¼ŒMySQLä¹Ÿæœ‰ç´¢å¼•ï¼Œå®ƒå¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚ä½†æ˜¯ï¼ŒRediså’ŒMySQLåœ¨æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢æœºåˆ¶ä¸Šæœ‰ä¸€äº›æ ¹æœ¬çš„åŒºåˆ«ï¼Œä½¿å¾—åœ¨æŸäº›åœºæ™¯ä¸‹Redisè¡¨ç°å¾—æ›´å¿«ã€‚
>
> - `å†…å­˜/ç£ç›˜`ï¼šRedisæ˜¯åŸºäºå†…å­˜å­˜å‚¨çš„ï¼Œè€ŒMySQLä¸»è¦æ˜¯åŸºäºç£ç›˜å­˜å‚¨ã€‚å†…å­˜è®¿é—®é€Ÿåº¦æ¯”ç£ç›˜è®¿é—®é€Ÿåº¦è¦å¿«å¾—å¤šï¼Œå› æ­¤Redisåœ¨è¯»å–æ•°æ®æ—¶é€šå¸¸ä¼šæ¯”MySQLæ›´å¿«ã€‚
> - `æ•°æ®ç»“æ„`:Rediså­˜å‚¨çš„æ˜¯k-væ ¼å¼çš„æ•°æ®ï¼Œéƒ¨åˆ†æ•°æ®ç»“æ„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œå³å¸¸æ•°é˜¶ï¼Œè€ŒMySQLå¼•æ“çš„åº•å±‚å®ç°é€šå¸¸æ˜¯B+Treeï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(logn)ï¼Œå³å¯¹æ•°é˜¶ã€‚è¿™æ„å‘³ç€åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒRedisæŸ¥æ‰¾æ•°æ®çš„é€Ÿåº¦ä¼šæ¯”MySQLæ›´å¿«ã€‚

### 8. ç´¢å¼•å¤±æ•ˆ

1å·¦æ¨¡ç³ŠåŒ¹é…çš„æ—¶å€™ï¼Œ2å¯¹ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°çš„æ—¶å€™ï¼Œ3å¯¹ç´¢å¼•è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—çš„æ—¶å€™ï¼Œ4å¦‚æœç´¢å¼•æ˜¯å­—ç¬¦ä¸²ï¼Œè¾“å…¥çš„æ˜¯æ•°å­—ï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡Œéšå½¢ç±»å‹è½¬æ¢ï¼Œç›¸å½“äºä½¿ç”¨äº†å‡½æ•°ï¼Œä¼šå¤±æ•ˆã€‚5è”åˆç´¢å¼•æ²¡æœ‰æœ€å·¦åŒ¹é…çš„æ—¶å€™ã€‚6ORå‰å’Œåéƒ½éœ€è¦æ˜¯ç´¢å¼•åˆ—ï¼Œä¸ç„¶ä¼šå¤±æ•ˆ

- å½“æˆ‘ä»¬ä½¿ç”¨**å·¦æˆ–è€…å·¦å³æ¨¡ç³ŠåŒ¹é…**çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯ `like %xx` æˆ–è€… `like %xx%`è¿™ä¸¤ç§æ–¹å¼éƒ½ä¼šé€ æˆç´¢å¼•å¤±æ•ˆï¼›
- å½“æˆ‘ä»¬åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­**å¯¹ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°**ï¼Œå°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚
- å½“æˆ‘ä»¬åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­å¯¹ç´¢å¼•åˆ—è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—ï¼Œä¹Ÿæ˜¯æ— æ³•èµ°ç´¢å¼•çš„ã€‚
- MySQL åœ¨é‡åˆ°å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æŠŠå­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—ï¼Œç„¶åå†è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå­—ç¬¦ä¸²æ˜¯ç´¢å¼•åˆ—ï¼Œè€Œæ¡ä»¶è¯­å¥ä¸­çš„è¾“å…¥å‚æ•°æ˜¯æ•°å­—çš„è¯ï¼Œé‚£ä¹ˆç´¢å¼•åˆ—ä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ï¼Œç”±äºéšå¼ç±»å‹è½¬æ¢æ˜¯é€šè¿‡ CAST å‡½æ•°å®ç°çš„ï¼Œç­‰åŒäºå¯¹ç´¢å¼•åˆ—ä½¿ç”¨äº†å‡½æ•°ï¼Œæ‰€ä»¥å°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚

  > ä½†æ˜¯å¦‚æœç´¢å¼•å­—æ®µæ˜¯æ•´å‹ç±»å‹ï¼ŒæŸ¥è¯¢æ¡ä»¶ä¸­çš„è¾“å…¥å‚æ•°å³ä½¿å­—ç¬¦ä¸²ï¼Œæ˜¯ä¸ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œè¿˜æ˜¯å¯ä»¥èµ°ç´¢å¼•æ‰«æ

- è”åˆç´¢å¼•è¦èƒ½æ­£ç¡®ä½¿ç”¨éœ€è¦éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§æœ€å·¦ä¼˜å…ˆçš„æ–¹å¼è¿›è¡Œç´¢å¼•çš„åŒ¹é…ï¼Œå¦åˆ™å°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚
- åœ¨ WHERE å­å¥ä¸­ï¼Œå¦‚æœåœ¨ OR å‰çš„æ¡ä»¶åˆ—æ˜¯ç´¢å¼•åˆ—ï¼Œè€Œåœ¨ OR åçš„æ¡ä»¶åˆ—ä¸æ˜¯ç´¢å¼•åˆ—ï¼Œé‚£ä¹ˆç´¢å¼•ä¼šå¤±æ•ˆã€‚

> å…·ä½“å‚ç…§ï¼šhttps://www.xiaolincoding.com/mysql/index/index_lose.html

### 9. å›è¡¨å’Œè¦†ç›–ç´¢å¼•çš„åŒºåˆ«

åœ¨æˆ‘ä»¬ä½¿ç”¨**ã€ŒäºŒçº§ç´¢å¼•ã€**å­—æ®µä½œä¸ºæ¡ä»¶æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¦‚æœè¦æŸ¥è¯¢çš„æ•°æ®éƒ½åœ¨**ã€Œèšç°‡ç´¢å¼•ã€**çš„å¶å­èŠ‚ç‚¹é‡Œï¼Œé‚£ä¹ˆéœ€è¦æ£€ç´¢ä¸¤é¢—B+æ ‘ï¼š

- å…ˆåœ¨ã€ŒäºŒçº§ç´¢å¼•ã€çš„ B+ æ ‘æ‰¾åˆ°å¯¹åº”çš„å¶å­èŠ‚ç‚¹ï¼Œè·å–ä¸»é”®å€¼ï¼›
- ç„¶åç”¨ä¸Šä¸€æ­¥è·å–çš„ä¸»é”®å€¼ï¼Œåœ¨ã€Œèšç°‡ç´¢å¼•ã€ä¸­çš„ B+ æ ‘æ£€ç´¢åˆ°å¯¹åº”çš„å¶å­èŠ‚ç‚¹ï¼Œç„¶åè·å–è¦æŸ¥è¯¢çš„æ•°æ®ã€‚

ä¸Šé¢è¿™ä¸ªè¿‡ç¨‹å«åš**å›è¡¨**ï¼Œå¦‚ä¸‹é¢è¿™æ¡è¯­å¥ï¼š

```SQL
// name å­—æ®µä¸ºäºŒçº§ç´¢å¼•
select * from t_user where name="æ—æŸ";
```

åœ¨æˆ‘ä»¬ä½¿ç”¨**ã€ŒäºŒçº§ç´¢å¼•ã€**å­—æ®µä½œä¸ºæ¡ä»¶æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¦‚æœè¦æŸ¥è¯¢çš„æ•°æ®åœ¨**ã€ŒäºŒçº§ç´¢å¼•ã€**çš„å¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆåªéœ€è¦åœ¨ã€ŒäºŒçº§ç´¢å¼•ã€çš„ B+ æ ‘æ‰¾åˆ°å¯¹åº”çš„å¶å­èŠ‚ç‚¹ï¼Œç„¶åè¯»å–è¦æŸ¥è¯¢çš„æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš**è¦†ç›–ç´¢å¼•**ã€‚å¦‚ä¸‹é¢è¿™æ¡è¯­å¥ï¼š

```SQL
// name å­—æ®µä¸ºäºŒçº§ç´¢å¼•
select id from t_user where name="æ—æŸ";
```

## é”æœºåˆ¶

### 1. æ•°æ®åº“ä¸­çš„é”

**åŸºäºé”çš„å±æ€§åˆ†ç±»ï¼š**

 1.**å…±äº«é”**ï¼ˆShare Lockï¼ŒSé”ï¼‰ï¼šå½“ä¸€ä¸ªäº‹åŠ¡ä¸ºæ•°æ®åŠ ä¸Šè¯»é”ä¹‹åï¼Œå…¶ä»–äº‹åŠ¡åªèƒ½å¯¹è¯¥æ•°æ®åŠ è¯»é”ï¼Œè€Œä¸èƒ½å¯¹æ•°æ®åŠ å†™é”ï¼Œç›´åˆ°æ‰€æœ‰çš„è¯»é”é‡Šæ”¾ä¹‹åå…¶ä»–äº‹åŠ¡æ‰èƒ½å¯¹å…¶è¿›è¡ŒåŠ æŒå†™é”ã€‚å…±äº«é”ä¸»è¦ç”¨äºæ”¯æŒå¹¶å‘çš„è¯»å–æ•°æ®ï¼Œè¯»å–æ•°æ®çš„æ—¶å€™ä¸æ”¯æŒä¿®æ”¹ï¼Œé¿å…å‡ºç°é‡å¤è¯»çš„é—®é¢˜ã€‚

 2.**æ’ä»–é”**ï¼ˆExclusive Lockï¼ŒXé”ï¼‰ï¼šå½“ä¸€ä¸ªäº‹åŠ¡ä¸ºæ•°æ®åŠ ä¸Šå†™é”æ—¶ï¼Œå…¶ä»–è¯·æ±‚å°†ä¸èƒ½å†ä¸ºæ•°æ®åŠ ä»»ä½•é”ï¼Œç›´åˆ°è¯¥é”é‡Šæ”¾ä¹‹åï¼Œå…¶ä»–äº‹åŠ¡æ‰èƒ½å¯¹æ•°æ®è¿›è¡ŒåŠ é”ã€‚æ’ä»–é”é¿å…äº†å‡ºç°è„æ•°æ®å’Œè„è¯»çš„é—®é¢˜ã€‚

**åŸºäºé”çš„ç²’åº¦åˆ†ç±»ï¼š**

 1.**è¡Œçº§é”**ï¼ˆInnoDBï¼‰ï¼šå¯¹æ•°æ®åº“è¡¨ä¸­çš„æŸä¸€è¡Œæˆ–å¤šè¡Œè®°å½•è¿›è¡ŒåŠ é”ï¼Œä½¿å¾—å…¶ä»–äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡é‡Šæ”¾é”ä¹‹å‰æ— æ³•ä¿®æ”¹è¿™äº›è®°å½•ã€‚ 2.**è¡¨çº§é”**ï¼ˆInnoDBã€MyISAMï¼‰ï¼šå¯¹æ•´ä¸ªæ•°æ®åº“è¡¨è¿›è¡ŒåŠ é”ï¼Œä½¿å¾—å…¶ä»–äº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡é‡Šæ”¾é”ä¹‹å‰æ— æ³•å¯¹è¯¥è¡¨è¿›è¡Œè®¿é—®æˆ–ä¿®æ”¹ã€‚è¡¨çº§é”åŒ…æ‹¬è¡¨å…±äº«è¯»é”å’Œè¡¨ç‹¬å å†™é”ã€‚ 3.**é¡µçº§é”**ï¼ˆInnoDBã€BDBå¼•æ“ï¼‰ï¼šæ˜¯ä¸€ç§ä»‹äºè¡Œçº§é”å’Œè¡¨çº§é”ä¹‹é—´çš„é”ï¼Œå®ƒé”å®šçš„æ˜¯æ•°æ®é¡µè€Œä¸æ˜¯æ•´ä¸ªè¡¨æˆ–å•ä¸ªè¡Œã€‚é¡µçº§é”åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥å‡å°‘é”çš„ç«äº‰ï¼Œæé«˜å¹¶å‘æ€§èƒ½ã€‚ 4.**è®°å½•é”**ï¼šè¡Œçº§é”çš„ä¸€ç§ï¼Œå•æ¡è®°å½•ä¸ŠåŠ çš„é”ã€‚ 5.**é—´éš™é”**ï¼ˆInnoDBï¼‰ï¼šåœ¨ç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™ä¸ŠåŠ çš„é”ï¼Œä¸»è¦ç”¨äºé˜²æ­¢ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶å‘ä¸€ä¸ªèŒƒå›´å†…æ’å…¥æ–°çš„è®°å½•ï¼Œäº§ç”Ÿå¹»è¯»çš„æƒ…å†µã€‚ 6.**ä¸´é”®é”**ï¼ˆNext-Key Locksï¼‰ï¼šæ˜¯InnoDBçš„è¡Œçº§é”å’Œé—´éš™é”çš„ç»“åˆï¼Œå³é™¤äº†é”ä½è®°å½•æœ¬èº«ï¼Œè¿˜è¦å†é”ä½ç´¢å¼•è®°å½•å‰é¢çš„é—´éš™ã€‚

**åŸºäºé”çš„çŠ¶æ€åˆ†ç±»ï¼š**

 1.æ„å‘å…±äº«é”ï¼ˆIntention Shared Lockï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ å…±äº«é”ã€‚ 2.æ„å‘æ’ä»–é”ï¼ˆIntention Exclusive Lockï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ æ’ä»–é”ã€‚

**å…¨å±€é”**ï¼š å¯¹æ•´ä¸ªæ•°æ®åº“è¿›è¡ŒåŠ é”ï¼Œé˜»æ­¢å…¶ä»–ç”¨æˆ·å¯¹è¯¥æ•°æ®åº“çš„è®¿é—®å’Œä¿®æ”¹ã€‚ä¾‹å¦‚ï¼Œå½“éœ€è¦è®©æ•´ä¸ªæ•°æ®åº“è¿›è¡Œå¤‡ä»½æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å…¨å±€é”ã€‚ä½†å…¨å±€é”ä¼šä¸¥é‡å½±å“å¹¶å‘æ€§èƒ½ï¼Œåº”è°¨æ…ä½¿ç”¨ã€‚

### 2. MySQL å¦‚ä½•è§£å†³å¹»è¯»çš„é—®é¢˜,InnoDBé»˜è®¤æ˜¯ç”¨å¯é‡å¤è¯»ï¼Œé‚£å‘ç”Ÿå¹»è¯»æ€ä¹ˆåŠï¼Ÿ

å¹»è¯»æ˜¯æŒ‡åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å¤šæ¬¡æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢ï¼Œä½†ç”±äºå…¶ä»–äº‹åŠ¡çš„æ’å…¥æ“ä½œï¼Œå¯¼è‡´ç»“æœé›†ä¸ä¸€è‡´çš„ç°è±¡ã€‚**InnoDBå¼•æ“é€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰å’Œé—´éš™é”ï¼ˆGap Locksï¼‰**æ¥è§£å†³å¹»è¯»é—®é¢˜ã€‚åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼ŒInnoDBä½¿ç”¨MVCCæ¥ä¿æŒäº‹åŠ¡å†…æ•°æ®çš„ä¸€è‡´æ€§è§†å›¾ã€‚åŒæ—¶ï¼ŒInnoDBçš„é—´éš™é”å¯ä»¥é˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨å·²é”å®šèŒƒå›´çš„é—´éš™ä¸­æ’å…¥æ–°çš„æ•°æ®ï¼Œä»è€Œç¡®ä¿åœ¨äº‹åŠ¡èŒƒå›´å†…ä¸ä¼šå‡ºç°æ–°çš„ã€æœªè¢«é”å®šçš„è¡Œï¼Œè¿™æ ·å°±è§£å†³äº†å¹»è¯»é—®é¢˜ã€‚

### 3. MVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶

1.ç‰ˆæœ¬é“¾ï¼š

å¤šä¸ªäº‹åŠ¡å¹¶è¡Œæ“ä½œæŸä¸€è¡Œæ•°æ®æ—¶ï¼Œä¸åŒäº‹åŠ¡å¯¹è¯¥è¡Œæ•°æ®çš„ä¿®æ”¹ä¼šäº§ç”Ÿå¤šä¸ªç‰ˆæœ¬ï¼Œç„¶åé€šè¿‡å›æ»šæŒ‡é’ˆï¼ˆroll_pointerï¼‰ï¼Œè¿æˆä¸€ä¸ªé“¾è¡¨ï¼Œè¿™ä¸ªé“¾è¡¨å°±ç§°ä¸º**ç‰ˆæœ¬é“¾**ã€‚å¦‚ä¸‹ï¼š

![img](https://fastly.jsdelivr.net/gh/52chen/imagebed2023@main/uPic/1090617-20211230222653290-1858853701.jpg)

2.å¿«ç…§è¯»å’Œå½“å‰è¯»

**å¿«ç…§è¯»**ï¼š è¯»å–çš„æ˜¯è®°å½•æ•°æ®çš„å¯è§ç‰ˆæœ¬ï¼ˆæœ‰æ—§çš„ç‰ˆæœ¬ï¼‰ã€‚ä¸åŠ é”,æ™®é€šçš„selectè¯­å¥éƒ½æ˜¯å¿«ç…§è¯»,å¦‚ï¼š

```sql
select * from user where id = 1;
```

**å½“å‰è¯»**ï¼šè¯»å–çš„æ˜¯è®°å½•æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œæ˜¾å¼åŠ é”çš„éƒ½æ˜¯å½“å‰è¯»

```sql
select * from user where id = 1 for update;
select * from user where id = 1 lock in share mode;
```

3.ReadView

ReadViewæ˜¯å¦‚ä½•ä¿è¯å¯è§æ€§åˆ¤æ–­çš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆçœ‹çœ‹ ReadView çš„å‡ ä¸ªé‡è¦å±æ€§

- **trx_ids**: å½“å‰ç³»ç»Ÿä¸­é‚£äº›æ´»è·ƒ(æœªæäº¤)çš„è¯»å†™äº‹åŠ¡ID, å®ƒæ•°æ®ç»“æ„ä¸ºä¸€ä¸ªListã€‚(`é‡ç‚¹æ³¨æ„`:è¿™é‡Œçš„trx_idsä¸­çš„æ´»è·ƒäº‹åŠ¡ï¼Œ**ä¸åŒ…æ‹¬å½“å‰äº‹åŠ¡è‡ªå·±**å’Œå·²æäº¤çš„äº‹åŠ¡ï¼Œè¿™ç‚¹éå¸¸é‡è¦)
- **low_limit_id**: ç›®å‰å‡ºç°è¿‡çš„æœ€å¤§çš„äº‹åŠ¡ID+1ï¼Œå³ä¸‹ä¸€ä¸ªå°†è¢«åˆ†é…çš„äº‹åŠ¡IDã€‚
- **up_limit_id**: æ´»è·ƒäº‹åŠ¡åˆ—è¡¨trx_idsä¸­æœ€å°çš„äº‹åŠ¡IDï¼Œå¦‚æœtrx_idsä¸ºç©ºï¼Œåˆ™up_limit_id ä¸º low_limit_idã€‚
- **creator_trx_id**: è¡¨ç¤ºç”Ÿæˆè¯¥ ReadView çš„äº‹åŠ¡çš„ äº‹åŠ¡id

ä¸åŒçš„äº‹åŠ¡éš”ç¦»çº§åˆ«å°±ä¼šæœ‰ReadView

è¿™é‡Œæ˜¯è¯»å·²æäº¤çš„éš”ç¦»çº§åˆ«ï¼šç”Ÿæˆäº†ä¸¤ä¸ªReadView

![image-20240324100109860](https://fastly.jsdelivr.net/gh/52chen/imagebed2023@main/uPic/image-20240324100109860.png)

![image-20240324100410585](https://fastly.jsdelivr.net/gh/52chen/imagebed2023@main/uPic/image-20240324100410585.png)

> å‚è€ƒï¼šhttps://www.bilibili.com/video/BV1hL411479T/

å¦‚æœæ˜¯å¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«å°±æ˜¯å¤ç”¨äº†ReadView

![image-20240324100744979](https://fastly.jsdelivr.net/gh/52chen/imagebed2023@main/uPic/image-20240324100744979.png)

è¿ç»­å¤šæ¬¡å¿«ç…§è¯»ï¼ŒReadViewä¼šäº§ç”Ÿå¤ç”¨ï¼Œæ²¡æœ‰å¹»è¯»é—®é¢˜

ç‰¹ä¾‹ï¼šå½“ä¸¤æ¬¡å¿«ç…§è¯»ä¹‹é—´å­˜åœ¨å½“å‰è¯»ï¼ŒReadViewä¼šé‡æ–°ç”Ÿæˆï¼Œå¯¼è‡´äº§ç”Ÿå¹»è¯»

![image-20240324103344826](https://fastly.jsdelivr.net/gh/52chen/imagebed2023@main/uPic/image-20240324103344826.png)
