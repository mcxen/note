## aliyun

Java基于内存实现MQ

#### 项目的令牌实现逻辑，

> 在分布式系统中，频繁的请求可能会导致系统负载过高，甚至导致系统崩溃。为了解决这个问题，我们可以使用令牌桶算法来对请求进行限流。Redis 作为一种高性能的缓存数据库，可以很好地支持令牌桶算法。
>
> 令牌桶算法是一种简单而有效的限流算法。它通过维护一个固定容量的令牌桶，每个请求在执行前需要从令牌桶中获取一个令牌，如果令牌桶中没有足够的令牌，则请求会被延迟或拒绝。通过控制令牌的发放速率，我们可以限制请求的并发数量，从而保护系统免受过多的请求压力。

大家去百度啊，去其他各种文章看到的令牌大厦的做法一般是放在内存,里面一个用户进来就会生成一个令牌，然后再redis记录这个令牌，用令牌桶统计这个做法是不会设计到数据库的，因为大家认为在数据库里面操作不如redis块，吧，我们设计就是方便，我们去查看或者做一些统计这些额外的操作在里面不够，方便我们这种关系就比较方便一些看看卖得最快，设计了一个可以统计哪个车次卖的最快。

我这里设计的是一个基于日期和车次的令牌，计算当前发布的车次的总座位数目，然后设计一个关系表，由于每次都去访问数据库，删减令牌，效率不高，修改

![image-20240318222007172](https://fastly.jsdelivr.net/gh/52chen/imagebed2023@main/uPic/image-20240318222007172.png)



1.加入lock，加入setIfAbsent的redis设计的锁，然后日期车次和用户ID构成，限流，实现一次限流，然后拿到了锁，再去访问数据库，令牌渐渐，

2.加入缓存，Redis缓存令牌数目，，判断有没有缓存，有缓存，就将缓存的令牌统计如果是5的倍数，就去更新数据库，减少对数据库的压力。

流程： 用户拿 当前日期+车次+用户ID的锁，拿到了之后走Redis的缓存的数目（减少查询次数），同一个令牌记录在redis，如果有了五次再去减数据库，

![截屏2024-03-18 22.48.17](https://fastly.jsdelivr.net/gh/52chen/imagebed2023@main/uPic/截屏2024-03-18 22.48.17.png)

#### Redisson

#### 基于DB实现分布式锁

在数据库中实现分布式锁可以通过以下步骤进行：

1. 创建一张用于存储锁信息的表，该表包含以下字段：
   - 锁名称：唯一标识锁的名称
   - 锁持有者：表示当前持有该锁的节点或进程的标识符
   - 过期时间：锁的过期时间，防止死锁
   - 创建时间：记录锁的创建时间
2. 当需要获取锁时，向数据库中插入一条记录来尝试获取锁。可以使用INSERT语句，如果插入成功则说明获取到了锁。
3. 为了避免死锁，可以设置锁的过期时间，当其他节点或进程尝试获取同一个锁时可以检查锁的过期时间，如果已经过期则可以重新获取锁。
4. 当不再需要锁时，可以通过DELETE语句来释放锁，删除对应的记录。

需要注意的是，在高并发环境下数据库实现分布式锁可能会面临性能瓶颈的问题，因此需要谨慎设计和优化。同时要考虑数据库的事务隔离级别和锁定机制，以确保数据的一致性和并发性。





## 阿里云 笔试 2024 4 7



KMP算法



### 相邻字符串

小红拿到了一个字符串，她想知道该字符串有多少连续子串满足：不存在两个相邻字符相同？

输入描述
第一行输入一个正整数n，代表字符串长度。
第二行输入一个长度为n的一个仅包含小写字母的字符串，长度不超过200000。

输出描述
合法的连续子串的数量。

示例 1
收起 

输入

3
bee
输出

5
说明
长度为0的子串（即空串）是合法的。
长度为1的3个子串都是合法的。
长度为2的子串中，只有"be"的合法的。
长度为3的子串不合法。
因此答案是5。



### 无向图还原

小红有一个 n 个点的无向图，但是她不知道这个图的具体结构。但是她知道这个图的所有点和 1 号点的最短距离，并且不存在一个点的度数大于 limit。
你能帮她还原出这个图吗（数据保证有解）。

输入描述
第一行两个整数 n 和 limit，表示点数和最大度数。
第二行输入 n 个整数表 d_i，表示 1 号点到 i 号点的最短距离。
$$
1 \leq limit \leq n \leq 10^5

0 \leq d_i \leq n - 1
$$
输出描述
先输出一行一个整数 m，表示边数。
接下来 m 行，每行两个整数 u_i 和 v_i，表示 u_i 和 v_i 之间有一条边。
如果有多解，输出任意一种即可。

示例 1
收起 

输入
3 3
0 1 1
输出
3
1 2
1 3
2 3